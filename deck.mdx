import BwTheme from './themes/theme.js'
export const theme = BwTheme

import Preso from './layouts/default.js'

<Preso>

# Bloom Filters and Offheap Java Memory
### _By Dan Goslen_

</Preso>

---

<Preso>

# What Are Bloom Filters?

> _Probablistic data structure that can say if it either does **NOT** contain an element, or that it **MIGHT** contain it_

</Preso>

---

<Preso>

# Remember Hashing?
* Given key _k_, calculate h(k)
* Use resulting _h_ to find a value in a table of size _m_

</Preso>

---

<Preso>

# General Algorithm
* Bit Array size _m_
* Calculate _i_ _h_ values, using some form of a "salt" to create unique hashes
* For each _h_i_ hash, find its position within _m_ bits and set it to 1

</Preso>

---

import { State, Observe } from 'mdx-observable'
import { Box, Input, Button } from '@theme-ui/components'

<State
  initialState={{
    bits: [0, 0, 0, 0, 0, 0, 0, 0, 0, 0],
    size: 10,
    check: false,
    clean: true,
  }}>

<Observe>
  { ({ bits }) => (
    <Box style={{ marginBottom: "30px" }}> {
      bits.map(v => (<div style={{display: 'inline-block', marginRight: '10px' }}>{ v }</div>))}
    </Box>
  ) }
</Observe>

<Observe>
  { ({ bits, size, setState }) =>
    (
        <form onSubmit={ e => {
          e.preventDefault();
          var name = document.getElementById("name").value;
          var hash = 0;
          for (var i = 0; i < name.length; i++) {
            var c = name.charCodeAt(i);
            hash = ((hash << 5) - hash) + c;
            hash = hash & hash;
          }
          var idx = hash % size;
          var updated = bits;
          updated[idx] = 1;
          setState(s => ({ ...s, bits: updated }));
        }} style={{ width: '100%'}} >
            <Input style={{ display: 'inline-block', width: '30%', marginLeft: '15%', marginRight: '5%' }} id="name" type="text" />
            <Button style={{ display: 'inline-block', width: '30%', marginLeft: '5%' }} type="submit">Add Name</Button>
        </form>
  ) }
</Observe>

<Observe>
  { ({ bits, size, setState }) =>
    (
        <form onSubmit={ e => {
          e.preventDefault();
          var name = document.getElementById("check").value;
          var hash = 0;
          for (var i = 0; i < name.length; i++) {
            var c = name.charCodeAt(i);
            hash = ((hash << 5) - hash) + c;
            hash = hash & hash;
          }
          var idx = hash % size;
          setState(s => ({ ...s, check: bits[idx] == 1, clean: false }));
        }} style={{ width: '100%'}} >
            <Input style={{ display: 'inline-block', width: '30%', marginLeft: '15%', marginRight: '5%' }} id="check" type="text" />
            <Button variant='secondy' style={{ display: 'inline-block', width: '30%', marginLeft: '5%' }} type="submit">Check Name</Button>
        </form>
  ) }
</Observe>

<Observe>
  { ({ clean, check, setState }) => (
      <div onClick={ e => {
        setState(s => ({ ...s, clean: true }));
      }} style={{ width: '15px', height: '15px' }} >
        { clean ? ' ' : check ? 'ü§∑‚Äç‚ôÇÔ∏è' : '‚ùå' }
      </div>
  ) }
</Observe>

</State>

---

## The End
